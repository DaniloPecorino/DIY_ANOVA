---
title: "ANOVA report"
author: ""
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
  word_document: default
params:
  posthoc: none
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE
)
```

## 0. Report structure

This a report automatically generated by the DIY_ANOVA app (<https://pecostats.shinyapps.io/DIY_ANOVA/>). It consists of the following sections:

1. Input data
2. Normality
3. Homoscedasticity
4. ANOVA results
5. Post-hoc test

## 1. Input data

```{r}
{{init}}
```

The input dataset has **`r nrow(inData)` records** and **`r ncol(inData)` variables**: *`r colnames(inData)`*.
For the following analysis, **`r predictors`** will be modelled as categorical predictive variables (factors), and **`r response`** as a continuous response variable.


## 2. Normality

```{r}
{{normal_test_transf}}
```

A **`r normal_test_transf$method`** was performed on the `r attr(response_transf_fun, "caption")` response variable was **`r ifelse(normal_test_transf$p.value > 0.5, "not significant", "significant")`** (D statistic = `r formatC(normal_test_transf$statistic)`, p-value = `r formatC(normal_test_transf$p.value)`). The distribution of the response variable, therefore, is `r ifelse(normal_test_transf$p.value > 0.5, "not", "significantly")`  significantly different from a normal distribution with the same mean and variance.

The followings charts are: **on the left a *QQ plot* ** produced to compare the distribution quantiles of the response variable with the theoretical quantiles of a normal distribution; **on the right a *bar chart* **that provides a visual representation of the distribution of the response variable itself.

```{r}
{{qq_plot}}
```

## 3. Homoscedasticity

```{r}
{{variance_test}}
```

Homogeneity of variances (i.e. homoscedasticity) was tested via **`r names(variance_test$statistic)` test on `r response` by `r predictors`**. This test was **`r ifelse(variance_test$p.value > 0.5, "not significant", "significant")`** (`r names(variance_test$statistic)` statistic = `r formatC(variance_test$statistic)`, p-value = `r formatC(variance_test$p.value)`). The variance of the response variable among groups, therefore, can`r ifelse(variance_test$p.value > 0.5, "", "not")` be assumed to be homogeneous.

```{r}
{{boxplot}}
```

## 4. ANOVA results

### 4.1.  ANOVA model and table

```{r}
{{linear_model}}
```

Factors were defined as follows: **`r Map(function(x, y) {  paste(x, "as", if (inherits(y, "random")) "random" else "fixed") }, names(factors_df), factors_df)`**, and the linear model underlying this ANOVA is:

<center> **`r deparse(formula(linear_model))`** </center>
<br>
Results of the `r length(predictors)`-way ANOVA are shown in the following table:

```{r}
{{anova_results}}
```

<br>

### 4.2.  Visualisation of the F tests

The following plots provide a visual representation of of the F test of each source of variability of the tested ANOVA model.

```{r}
{{F_chart}}
```

## 5. Post-hoc tests

Post-hoc tests are shown in the following table. `r ifelse(params$posthoc != "none", paste0("The ", params$posthoc), "No")` correction was applied to the p-values of each comparison. 

<br>
<br>

```{r}
{{posthoc_results}}
```

<hr>
<font size = 1>This report was generated through the DIY_ANOVA app developed by Danilo Pecorino (danilo.pecorino@gmail.com). Do get in touch in case you find bugs or anything that does not work as you would expect; or just to say hi!</font>

